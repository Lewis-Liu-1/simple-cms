<?php
 	require_once(RootDir.ViewDir.'/header.php');
 	require_once(RootDir.ViewDir.'/menu_print.php');
 	require_once(RootDir.ModelDir.'/setup.php');
 	require_once(RootDir.ModelDir.'/file_conv.php');

	define(SHOW_FILE,11);
	define(SHOW_MAIN_FOLDER,12);
	define(SHOW_FOLDER,13);
	define(SHOW_HOME,14);
	
	$s=PWS::factory(SupportedSystem);
	$menus=$s::singleton();

	$ID = $_GET[$_QID];
	$HO = pack("H*",$_GET[$_QHOME]);
	$CA = pack("H*",$_GET[$_QCATE]);
	$option=0;
	$option=SHOW_HOME;
	
	$files=$menus->read_folder($HO,$CA);
	if ($menus->file_exist($ID,$files)==true)
	{		
		$option=SHOW_FILE;
		$file_ab_path=$menus->read_file($ID,$files);
	}
	else if (count($files)>0)
	{
		$option=SHOW_FOLDER;	
	}
	else if ($menus->folder_exist($HO))
	{
		$option=SHOW_MAIN_FOLDER;	
	}
	else {
		$file_ad_path=WelcomeFilePath;	
	}
	?>
	<body >
		<center>
	   <div id="main_content">
		<div id="header">
		<?php 
			$m=new web_menus();
			$m->print_menus($menus->menus);
		 	$m->print_web_path($HO,$CA,$menus->menus);
		?>
		</div>
		
	   <div id="container">
			<div class="right_section">
			<?php
				require_once(RootDir.ViewDir.'/ads_right.inc');
				require_once(RootDir.ViewDir.'/login.php');
				require_once(RootDir.ViewDir.'/list_articles.php');
				require_once(RootDir.ViewDir.'/list_comments.php');
			?>
			</div>
			
	   	<div id="content">
	         <div id="main">
					<?php
						$f=new file_converter();
						if ($option== SHOW_FILE)
						{
							//echo "$file_ab_path<br/>";
							$f->print_file_content($file_ab_path);
						 	//require_once(ROOT_DIR.'/driver/comment_parser.php');
							//$ss
						}
						else if ($option == SHOW_MAIN_FOLDER){
							$m->print_cat($HO,$menus->menus);
						}
						else if ($option == SHOW_FOLDER)
						{
							$m->print_links($HO,$CA,$menus->read_folder($HO,$CA));
						}	
						else 
						{
							$f->print_file_content(WelcomeFilePath);
						}

						if ($option== SHOW_FILE)
						{
							require_once(RootDir.ViewDir."/input_form.php");
						}
					?>
				</div>
   		</div>
   	</div>
   		
		<?php
			if ($option== SHOW_FILE)
			{
				$f->print_file_name($file_ab_path);
				$m->print_links($HO,$CA,$menus->read_folder($HO,$CA));
			}
	 		require_once(RootDir.ViewDir."/footer.inc");
		?>
	